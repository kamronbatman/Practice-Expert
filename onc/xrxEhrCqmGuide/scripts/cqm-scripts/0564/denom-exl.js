var cqmGuideController = require("../../../controllers/cqmGuideController.js");
module.exports = function (patId, fromDate, toDate, dctId, fclId, callback) {

  var sql1 = "declare @InitialPopOrDenom table \
              ( \
                PatId varchar(25), \
                DateOfVisit smalldatetime, \
                StopDate smalldatetime, \
                StartDate smalldatetime \
              ) \
              declare  @tempTableA table \
              ( \
                PatId varchar(25), \
                DateOfVisit smalldatetime, \
                StopDate smalldatetime, \
                StartDate smalldatetime \
              ) \
              declare  @tempTableB table \
              ( \
                PatId varchar(25), \
                DateOfVisit smalldatetime, \
                StopDate smalldatetime, \
                StartDate smalldatetime \
              ) \
              declare  @DenomExc table \
              ( \
                PatId varchar(25) \
              ) \
              insert into @InitialPopOrDenom \
              select (cqm.PatId), cqm.DateOfVisit, cqm.StopDate, cqm.StartDate \
              from xrxEhr_CQM cqm \
              where \
              ( \
                (cqm.PatId = '"+patId+"') \
                and (cqm.ReasonCode is null) \
                and \
                ( \
                  cqm.Code = '10178000' or cqm.Code = '110473004' or cqm.Code = '112963003' or cqm.Code = '112964009' or cqm.Code = '12163000' or cqm.Code = '231744001' or cqm.Code = '308694002' or cqm.Code = '308695001' or cqm.Code = '313999004' or cqm.Code = '31705006' or cqm.Code = '335636001' or cqm.Code = '336651000' or cqm.Code = '35717002' or cqm.Code = '361191005' or cqm.Code = '385468004' or cqm.Code = '39243005' or cqm.Code = '397544007' or cqm.Code = '404628003' or cqm.Code = '415089008' or cqm.Code = '417493007' or cqm.Code = '418430006' or cqm.Code = '419767009' or cqm.Code = '420260004' or cqm.Code = '420526005' or cqm.Code = '424945000' or cqm.Code = '446548003' or cqm.Code = '46309001' or cqm.Code = '46426006' or cqm.Code = '46562009' or cqm.Code = '50538003' or cqm.Code = '5130002' or cqm.Code = '51839008' or cqm.Code = '54885007' or cqm.Code = '65812008' or cqm.Code = '67760003' or cqm.Code = '69360005' or cqm.Code = '74490003' or cqm.Code = '75814005' or cqm.Code = '79611007' or cqm.Code = '82155009' or cqm.Code = '84149000' or cqm.Code = '85622008' or cqm.Code = '88282000' or cqm.Code = '89153001' or cqm.Code = '9137006' or cqm.Code = '66840' or cqm.Code = '66850' or cqm.Code = '66852' or cqm.Code = '66920' or cqm.Code = '66930' or cqm.Code = '66940' or cqm.Code = '66982' or cqm.Code = '66983' or cqm.Code = '66984' \
                ) \
                and (cqm.DateOfVisit >= '"+fromDate+"') and (cqm.DateOfVisit <= '"+toDate+"') and  (isNull(cqm.FclId, '') = case when ('"+fclId+"' = '')  then isNull(cqm.FclId, '') else '"+fclId+"' end) and  (isNull(cqm.DctId, '') = case when ('"+dctId+"' = '')  then isNull(cqm.DctId, '') else '"+dctId+"' end) \
              ) \
              insert into @tempTableA \
              select cqm.PatId, cqm.DateOfVisit, cqm.StopDate, cqm.StartDate \
              from  xrxEhr_CQM cqm \
              where \
              ( \
                (cqm.PatId = '"+patId+"') \
                and \
                ( \
                  cqm.Code = '87021001' or cqm.Code = '67036' or cqm.Code = '67039' or cqm.Code = '67040' or cqm.Code = '67041' or cqm.Code = '67042' or cqm.Code = '67043' \
                ) \
                and \
                (isNull(cqm.FclId, '') = case when ('"+fclId+"' = '')  then isNull(cqm.FclId, '') else '"+fclId+"' end) and  (isNull(cqm.DctId, '') = case when ('"+dctId+"' = '')  then isNull(cqm.DctId, '') else '"+dctId+"' end) \
              ) \
              insert into @tempTableB \
              select cqm.PatId, cqm.DateOfVisit, cqm.StopDate, cqm.StartDate \
              from  xrxEhr_CQM cqm  \
              where \
              ( \
                (cqm.PatId = '"+patId+"') \
                and \
                ( \
                  cqm.Code = '10698009' or cqm.Code = '11226001' or cqm.Code = '12630008' or cqm.Code = '13608004' or cqm.Code = '14427009' or cqm.Code = '186266008' or cqm.Code = '193487008' or cqm.Code = '193488003' or cqm.Code = '193493000' or cqm.Code = '23798003' or cqm.Code = '267618008' or cqm.Code = '29538005' or cqm.Code = '30080002' or cqm.Code = '416449002' or cqm.Code = '420485005' or cqm.Code = '46916006' or cqm.Code = '6869001' or cqm.Code = '70461003' or cqm.Code = '77971008' or cqm.Code = '89114005' or cqm.Code = '9091006' or cqm.Code = '364.00' or cqm.Code = '364.01' or cqm.Code = '364.02' or cqm.Code = '364.03' or cqm.Code = '364.04' or cqm.Code = '364.05' or cqm.Code = 'H20.00' or cqm.Code = 'H20.011' or cqm.Code = 'H20.012' or cqm.Code = 'H20.013' or cqm.Code = 'H20.019' or cqm.Code = 'H20.021' or cqm.Code = 'H20.022' or cqm.Code = 'H20.023' or cqm.Code = 'H20.029' or cqm.Code = 'H20.031' or cqm.Code = 'H20.032' or cqm.Code = 'H20.033' or cqm.Code = 'H20.039' or cqm.Code = 'H20.041' or cqm.Code = 'H20.042' or cqm.Code = 'H20.043' or cqm.Code = 'H20.049' or cqm.Code = 'H20.051' or cqm.Code = 'H20.052' or cqm.Code = 'H20.053' or cqm.Code = 'H20.059' \
                  or cqm.Code = '111512005' or cqm.Code = '1869002' or cqm.Code = '193507008' or cqm.Code = '193525001' or cqm.Code = '247034002' or cqm.Code = '247041008' or cqm.Code = '247043006' or cqm.Code = '251730004' or cqm.Code = '251731000' or cqm.Code = '253231007' or cqm.Code = '253232000' or cqm.Code = '253233005' or cqm.Code = '253240006' or cqm.Code = '267624002' or cqm.Code = '28900006' or cqm.Code = '302217008' or cqm.Code = '303019009' or cqm.Code = '370504007' or cqm.Code = '404633004' or cqm.Code = '410556000' or cqm.Code = '418106004' or cqm.Code = '419237004' or cqm.Code = '45953007' or cqm.Code = '55828000' or cqm.Code = '57286009' or cqm.Code = '6640008' or cqm.Code = '70992005' or cqm.Code = '75895005' or cqm.Code = '78778007' or cqm.Code = '95710002' or cqm.Code = '95712005' or cqm.Code = '95716008' or cqm.Code = '364.70' or cqm.Code = '364.71' or cqm.Code = '364.72' or cqm.Code = '364.73' or cqm.Code = '364.74' or cqm.Code = '364.75' or cqm.Code = '364.76' or cqm.Code = '364.77' or cqm.Code = '364.81' or cqm.Code = '364.82' or cqm.Code = '364.89' or cqm.Code = 'H21.40' or cqm.Code = 'H21.41' or cqm.Code = 'H21.42' or cqm.Code = 'H21.43' or cqm.Code = 'H21.501' or cqm.Code = 'H21.502' or cqm.Code = 'H21.503' or cqm.Code = 'H21.509' or cqm.Code = 'H21.511' or cqm.Code = 'H21.512' or cqm.Code = 'H21.513' or cqm.Code = 'H21.519' or cqm.Code = 'H21.521' or cqm.Code = 'H21.522' or cqm.Code = 'H21.523' or cqm.Code = 'H21.529' or cqm.Code = 'H21.531' or cqm.Code = 'H21.532' or cqm.Code = 'H21.533' or cqm.Code = 'H21.539' or cqm.Code = 'H21.541' or cqm.Code = 'H21.542' or cqm.Code = 'H21.543' or cqm.Code = 'H21.549' or cqm.Code = 'H21.551' or cqm.Code = 'H21.552' or cqm.Code = 'H21.553' or cqm.Code = 'H21.559' or cqm.Code = 'H21.561' or cqm.Code = 'H21.562' or cqm.Code = 'H21.563' or cqm.Code = 'H21.569' or cqm.Code = 'H21.81' or cqm.Code = 'H21.82' or cqm.Code = 'H21.89' or cqm.Code = 'H22' \
                  or cqm.Code = '231901007' or cqm.Code = '397567009' or cqm.Code = '397570008' or cqm.Code = '42513006' or cqm.Code = '95731004' or cqm.Code = '95732006' or cqm.Code = '95733001' or cqm.Code = '370.03' or cqm.Code = 'H16.011' or cqm.Code = 'H16.012' or cqm.Code = 'H16.013' or cqm.Code = 'H16.019' \
                  or cqm.Code = '110170006' or cqm.Code = '110171005' or cqm.Code = '110172003' or cqm.Code = '110173008' or cqm.Code = '16096002' or cqm.Code = '211659009' or cqm.Code = '211661000' or cqm.Code = '211662007' or cqm.Code = '211665009' or cqm.Code = '211666005' or cqm.Code = '211686009' or cqm.Code = '211704004' or cqm.Code = '211717001' or cqm.Code = '211725004' or cqm.Code = '211738007' or cqm.Code = '231819004' or cqm.Code = '231844007' or cqm.Code = '231867009' or cqm.Code = '231869007' or cqm.Code = '231884003' or cqm.Code = '231943000' or cqm.Code = '231945007' or cqm.Code = '232028002' or cqm.Code = '269232009' or cqm.Code = '269234005' or cqm.Code = '274204004' or cqm.Code = '274205003' or cqm.Code = '284199004' or cqm.Code = '284537006' or cqm.Code = '284541005' or cqm.Code = '284542003' or cqm.Code = '287132002' or cqm.Code = '287133007' or cqm.Code = '287134001' or cqm.Code = '287137008' or cqm.Code = '287138003' or cqm.Code = '312646002' or cqm.Code = '314531003' or cqm.Code = '38916004' or cqm.Code = '418591009' or cqm.Code = '423838005' or cqm.Code = '445832003' or cqm.Code = '445850005' or cqm.Code = '446234004' or cqm.Code = '446556000' or cqm.Code = '446856005' or cqm.Code = '447094002' or cqm.Code = '447095001' or cqm.Code = '447333000' or cqm.Code = '53642007' or cqm.Code = '63542002' or cqm.Code = '66526003' or cqm.Code = '71157005' or cqm.Code = '88552007' or cqm.Code = '940.0' or cqm.Code = '940.1' or cqm.Code = '940.2' or cqm.Code = '940.3' or cqm.Code = '940.4' or cqm.Code = '940.5' or cqm.Code = '940.9' or cqm.Code = 'T26.00XA' or cqm.Code = 'T26.01XA' or cqm.Code = 'T26.02XA' or cqm.Code = 'T26.10XA' or cqm.Code = 'T26.11XA' or cqm.Code = 'T26.12XA' or cqm.Code = 'T26.20XA' or cqm.Code = 'T26.21XA' or cqm.Code = 'T26.22XA' or cqm.Code = 'T26.30XA' or cqm.Code = 'T26.31XA' or cqm.Code = 'T26.32XA' or cqm.Code = 'T26.40XA' or cqm.Code = 'T26.41XA' or cqm.Code = 'T26.42XA' or cqm.Code = 'T26.50XA' or cqm.Code = 'T26.51XA' or cqm.Code = 'T26.52XA' or cqm.Code = 'T26.60XA' or cqm.Code = 'T26.61XA' or cqm.Code = 'T26.62XA' or cqm.Code = 'T26.70XA' or cqm.Code = 'T26.71XA' or cqm.Code = 'T26.72XA' or cqm.Code = 'T26.80XA' or cqm.Code = 'T26.81XA' or cqm.Code = 'T26.82XA' or cqm.Code = 'T26.90XA' or cqm.Code = 'T26.91XA' or cqm.Code = 'T26.92XA' \
                  or cqm.Code = '111514006' or cqm.Code = '365.52' or cqm.Code = 'H40.1410' or cqm.Code = 'H40.1411' or cqm.Code = 'H40.1412' or cqm.Code = 'H40.1413' or cqm.Code = 'H40.1414' or cqm.Code = 'H40.1420' or cqm.Code = 'H40.1421' or cqm.Code = 'H40.1422' or cqm.Code = 'H40.1423' or cqm.Code = 'H40.1424' or cqm.Code = 'H40.1430' or cqm.Code = 'H40.1431' or cqm.Code = 'H40.1432' or cqm.Code = 'H40.1433' or cqm.Code = 'H40.1434' or cqm.Code = 'H40.1490' or cqm.Code = 'H40.1491' or cqm.Code = 'H40.1492' or cqm.Code = 'H40.1493' or cqm.Code = 'H40.1494' \
                  or cqm.Code = '111515007' or cqm.Code = '11422002' or cqm.Code = '193589009' or cqm.Code = '39450006' or cqm.Code = '44219007' or cqm.Code = '445213003' or cqm.Code = '5318001' or cqm.Code = '77873007' or cqm.Code = '78875003' or cqm.Code = '366.11' or cqm.Code = 'H25.89' \
                  or cqm.Code = '193281006' or cqm.Code = '19721008' or cqm.Code = '2251002' or cqm.Code = '23360000' or cqm.Code = '420011000' or cqm.Code = '424497004' or cqm.Code = '53885001' or cqm.Code = '6777006' or cqm.Code = '95255005' or cqm.Code = '360.30' or cqm.Code = '360.31' or cqm.Code = '360.32' or cqm.Code = '360.33' or cqm.Code = '360.34' or cqm.Code = 'H44.40' or cqm.Code = 'H44.411' or cqm.Code = 'H44.412' or cqm.Code = 'H44.413' or cqm.Code = 'H44.419' or cqm.Code = 'H44.421' or cqm.Code = 'H44.422' or cqm.Code = 'H44.423' or cqm.Code = 'H44.429' or cqm.Code = 'H44.431' or cqm.Code = 'H44.432' or cqm.Code = 'H44.433' or cqm.Code = 'H44.439' or cqm.Code = 'H44.441' or cqm.Code = 'H44.442' or cqm.Code = 'H44.443' or cqm.Code = 'H44.449' \
                  or cqm.Code = '193600001' or cqm.Code = '193602009' or cqm.Code = '21818003' or cqm.Code = '23273003' or cqm.Code = '67733005' or cqm.Code = '76309006' or cqm.Code = '366.32' or cqm.Code = '366.33' or cqm.Code = 'H26.211' or cqm.Code = 'H26.212' or cqm.Code = 'H26.213' or cqm.Code = 'H26.219' or cqm.Code = 'H26.221' or cqm.Code = 'H26.222' or cqm.Code = 'H26.223' or cqm.Code = 'H26.229' \
                  or cqm.Code = '232125001' or cqm.Code = '232126000' or cqm.Code = '232127009' or cqm.Code = '232128004' or cqm.Code = '232129007' or cqm.Code = '232131003' or cqm.Code = '232132005' or cqm.Code = '38101003' or cqm.Code = '367.0' or cqm.Code = 'H52.00' or cqm.Code = 'H52.01' or cqm.Code = 'H52.02' or cqm.Code = 'H52.03' \
                  or cqm.Code = '212141007' or cqm.Code = '212142000' or cqm.Code = '230514006' or cqm.Code = '230515007' or cqm.Code = '230519001' or cqm.Code = '48233004' or cqm.Code = '69820004' or cqm.Code = '80499003' or cqm.Code = '950.0' or cqm.Code = '950.1' or cqm.Code = '950.2' or cqm.Code = '950.3' or cqm.Code = '950.9' or cqm.Code = 'S04.011A' or cqm.Code = 'S04.012A' or cqm.Code = 'S04.019A' or cqm.Code = 'S04.02XA' or cqm.Code = 'S04.031A' or cqm.Code = 'S04.032A' or cqm.Code = 'S04.039A' or cqm.Code = 'S04.041A' or cqm.Code = 'S04.042A' or cqm.Code = 'S04.049A' \
                  or cqm.Code = '204128001' or cqm.Code = '204130004' or cqm.Code = '204138006' or cqm.Code = '204139003' or cqm.Code = '21590003' or cqm.Code = '253223002' or cqm.Code = '253224008' or cqm.Code = '253225009' or cqm.Code = '253226005' or cqm.Code = '253227001' or cqm.Code = '268159001' or cqm.Code = '28550007' or cqm.Code = '29590001' or cqm.Code = '63912009' or cqm.Code = '66499004' or cqm.Code = '76562003' or cqm.Code = '79410001' or cqm.Code = '743.30' or cqm.Code = 'Q12.0' \
                  or cqm.Code = '193511002' or cqm.Code = '193515006' or cqm.Code = '267621005' or cqm.Code = '47269005' or cqm.Code = '63317005' or cqm.Code = '364.60' or cqm.Code = '364.61' or cqm.Code = '364.62' or cqm.Code = '364.63' or cqm.Code = '364.64' or cqm.Code = 'H21.301' or cqm.Code = 'H21.302' or cqm.Code = 'H21.303' or cqm.Code = 'H21.309' or cqm.Code = 'H21.311' or cqm.Code = 'H21.312' or cqm.Code = 'H21.313' or cqm.Code = 'H21.319' or cqm.Code = 'H21.321' or cqm.Code = 'H21.322' or cqm.Code = 'H21.323' or cqm.Code = 'H21.329' or cqm.Code = 'H21.341' or cqm.Code = 'H21.342' or cqm.Code = 'H21.343' or cqm.Code = 'H21.349' or cqm.Code = 'H21.351' or cqm.Code = 'H21.352' or cqm.Code = 'H21.353' or cqm.Code = 'H21.359' \
                  or cqm.Code = '10100008' or cqm.Code = '19144002' or cqm.Code = '19309007' or cqm.Code = '193546005' or cqm.Code = '193552006' or cqm.Code = '193555008' or cqm.Code = '193561006' or cqm.Code = '193562004' or cqm.Code = '206248004' or cqm.Code = '21571006' or cqm.Code = '232086000' or cqm.Code = '232090003' or cqm.Code = '23986001' or cqm.Code = '267625001' or cqm.Code = '275477002' or cqm.Code = '27735002' or cqm.Code = '29369005' or cqm.Code = '30041005' or cqm.Code = '314784002' or cqm.Code = '33647009' or cqm.Code = '34623005' or cqm.Code = '367360002' or cqm.Code = '37155002' or cqm.Code = '392288006' or cqm.Code = '392291006' or cqm.Code = '392352004' or cqm.Code = '444863008' or cqm.Code = '55129006' or cqm.Code = '65460003' or cqm.Code = '66725002' or cqm.Code = '68241007' or cqm.Code = '89215000' or cqm.Code = '95250000' or cqm.Code = '365.10' or cqm.Code = '365.11' or cqm.Code = '365.12' or cqm.Code = '365.13' or cqm.Code = '365.14' or cqm.Code = '365.15' or cqm.Code = '365.20' or cqm.Code = '365.21' or cqm.Code = '365.22' or cqm.Code = '365.23' or cqm.Code = '365.24' or cqm.Code = '365.31' or cqm.Code = '365.32' or cqm.Code = '365.51' or cqm.Code = '365.52' or cqm.Code = '365.59' or cqm.Code = '365.60' or cqm.Code = '365.61' or cqm.Code = '365.62' or cqm.Code = '365.63' or cqm.Code = '365.64' or cqm.Code = '365.65' or cqm.Code = '365.81' or cqm.Code = '365.82' or cqm.Code = '365.83' or cqm.Code = '365.89' or cqm.Code = 'H40.10X0' or cqm.Code = 'H40.10X1' or cqm.Code = 'H40.10X2' or cqm.Code = 'H40.10X3' or cqm.Code = 'H40.10X4' or cqm.Code = 'H40.11X0' or cqm.Code = 'H40.11X1' or cqm.Code = 'H40.11X2' or cqm.Code = 'H40.11X3' or cqm.Code = 'H40.11X4' or cqm.Code = 'H40.1210' or cqm.Code = 'H40.1211' or cqm.Code = 'H40.1212' or cqm.Code = 'H40.1213' or cqm.Code = 'H40.1214' or cqm.Code = 'H40.1220' or cqm.Code = 'H40.1221' or cqm.Code = 'H40.1222' or cqm.Code = 'H40.1223' or cqm.Code = 'H40.1224' or cqm.Code = 'H40.1230' or cqm.Code = 'H40.1231' or cqm.Code = 'H40.1232' or cqm.Code = 'H40.1233' or cqm.Code = 'H40.1234' or cqm.Code = 'H40.1290' or cqm.Code = 'H40.1291' or cqm.Code = 'H40.1292' or cqm.Code = 'H40.1293' or cqm.Code = 'H40.1294' or cqm.Code = 'H40.1310' or cqm.Code = 'H40.1311' or cqm.Code = 'H40.1312' or cqm.Code = 'H40.1313' or cqm.Code = 'H40.1314' or cqm.Code = 'H40.1320' or cqm.Code = 'H40.1321' or cqm.Code = 'H40.1322' or cqm.Code = 'H40.1323' or cqm.Code = 'H40.1324' or cqm.Code = 'H40.1330' or cqm.Code = 'H40.1331' or cqm.Code = 'H40.1332' or cqm.Code = 'H40.1333' or cqm.Code = 'H40.1334' or cqm.Code = 'H40.1390' or cqm.Code = 'H40.1391' or cqm.Code = 'H40.1392' or cqm.Code = 'H40.1393' or cqm.Code = 'H40.1394' or cqm.Code = 'H40.1410' or cqm.Code = 'H40.1411' or cqm.Code = 'H40.1412' or cqm.Code = 'H40.1413' or cqm.Code = 'H40.1414' or cqm.Code = 'H40.1420' or cqm.Code = 'H40.1421' or cqm.Code = 'H40.1422' or cqm.Code = 'H40.1423' or cqm.Code = 'H40.1424' or cqm.Code = 'H40.1430' or cqm.Code = 'H40.1431' or cqm.Code = 'H40.1432' or cqm.Code = 'H40.1433' or cqm.Code = 'H40.1434' or cqm.Code = 'H40.1490' or cqm.Code = 'H40.1491' or cqm.Code = 'H40.1492' or cqm.Code = 'H40.1493' or cqm.Code = 'H40.1494' or cqm.Code = 'H40.151' or cqm.Code = 'H40.152' or cqm.Code = 'H40.153' or cqm.Code = 'H40.159' or cqm.Code = 'H40.20X0' or cqm.Code = 'H40.20X1' or cqm.Code = 'H40.20X2' or cqm.Code = 'H40.20X3' or cqm.Code = 'H40.20X4' or cqm.Code = 'H40.211' or cqm.Code = 'H40.212' or cqm.Code = 'H40.213' or cqm.Code = 'H40.219' or cqm.Code = 'H40.2210' or cqm.Code = 'H40.2211' or cqm.Code = 'H40.2212' or cqm.Code = 'H40.2213' or cqm.Code = 'H40.2214' or cqm.Code = 'H40.2220' or cqm.Code = 'H40.2221' or cqm.Code = 'H40.2222' or cqm.Code = 'H40.2223' or cqm.Code = 'H40.2224' or cqm.Code = 'H40.2230' or cqm.Code = 'H40.2231' or cqm.Code = 'H40.2232' or cqm.Code = 'H40.2233' or cqm.Code = 'H40.2234' or cqm.Code = 'H40.2290' or cqm.Code = 'H40.2291' or cqm.Code = 'H40.2292' or cqm.Code = 'H40.2293' or cqm.Code = 'H40.2294' or cqm.Code = 'H40.231' or cqm.Code = 'H40.232' or cqm.Code = 'H40.233' or cqm.Code = 'H40.239' or cqm.Code = 'H40.241' or cqm.Code = 'H40.242' or cqm.Code = 'H40.243' or cqm.Code = 'H40.249' or cqm.Code = 'H40.30X0' or cqm.Code = 'H40.30X1' or cqm.Code = 'H40.30X2' or cqm.Code = 'H40.30X3' or cqm.Code = 'H40.30X4' or cqm.Code = 'H40.31X0' or cqm.Code = 'H40.31X1' or cqm.Code = 'H40.31X2' or cqm.Code = 'H40.31X3' or cqm.Code = 'H40.31X4' or cqm.Code = 'H40.32X0' or cqm.Code = 'H40.32X1' or cqm.Code = 'H40.32X2' or cqm.Code = 'H40.32X3' or cqm.Code = 'H40.32X4' or cqm.Code = 'H40.33X0' or cqm.Code = 'H40.33X1' or cqm.Code = 'H40.33X2' or cqm.Code = 'H40.33X3' or cqm.Code = 'H40.33X4' or cqm.Code = 'H40.40X0' or cqm.Code = 'H40.40X1' or cqm.Code = 'H40.40X2' or cqm.Code = 'H40.40X3' or cqm.Code = 'H40.40X4' or cqm.Code = 'H40.41X0' or cqm.Code = 'H40.41X1' or cqm.Code = 'H40.41X2' or cqm.Code = 'H40.41X3' or cqm.Code = 'H40.41X4' or cqm.Code = 'H40.42X0' or cqm.Code = 'H40.42X1' or cqm.Code = 'H40.42X2' or cqm.Code = 'H40.42X3' or cqm.Code = 'H40.42X4' or cqm.Code = 'H40.43X0' or cqm.Code = 'H40.43X1' or cqm.Code = 'H40.43X2' or cqm.Code = 'H40.43X3' or cqm.Code = 'H40.43X4' or cqm.Code = 'H40.50X0' or cqm.Code = 'H40.50X1' or cqm.Code = 'H40.50X2' or cqm.Code = 'H40.50X3' or cqm.Code = 'H40.50X4' or cqm.Code = 'H40.51X0' or cqm.Code = 'H40.51X1' or cqm.Code = 'H40.51X2' or cqm.Code = 'H40.51X3' or cqm.Code = 'H40.51X4' or cqm.Code = 'H40.52X0' or cqm.Code = 'H40.52X1' or cqm.Code = 'H40.52X2' or cqm.Code = 'H40.52X3' or cqm.Code = 'H40.52X4' or cqm.Code = 'H40.53X0' or cqm.Code = 'H40.53X1' or cqm.Code = 'H40.53X2' or cqm.Code = 'H40.53X3' or cqm.Code = 'H40.53X4' or cqm.Code = 'H40.60X0' or cqm.Code = 'H40.60X1' or cqm.Code = 'H40.60X2' or cqm.Code = 'H40.60X3' or cqm.Code = 'H40.60X4' or cqm.Code = 'H40.61X0' or cqm.Code = 'H40.61X1' or cqm.Code = 'H40.61X2' or cqm.Code = 'H40.61X3' or cqm.Code = 'H40.61X4' or cqm.Code = 'H40.62X0' or cqm.Code = 'H40.62X1' or cqm.Code = 'H40.62X2' or cqm.Code = 'H40.62X3' or cqm.Code = 'H40.62X4' or cqm.Code = 'H40.63X0' or cqm.Code = 'H40.63X1' or cqm.Code = 'H40.63X2' or cqm.Code = 'H40.63X3' or cqm.Code = 'H40.63X4' or cqm.Code = 'H40.811' or cqm.Code = 'H40.812' or cqm.Code = 'H40.813' or cqm.Code = 'H40.819' or cqm.Code = 'H40.821' or cqm.Code = 'H40.822' or cqm.Code = 'H40.823' or cqm.Code = 'H40.829' or cqm.Code = 'H40.831' or cqm.Code = 'H40.832' or cqm.Code = 'H40.833' or cqm.Code = 'H40.839' or cqm.Code = 'H40.89' or cqm.Code = 'Q15.0' \
                  or cqm.Code = '193590000' or cqm.Code = '264443002' or cqm.Code = '267626000' or cqm.Code = '849000' or cqm.Code = '8656007' or cqm.Code = '95724003' or cqm.Code = '366.9' or cqm.Code = 'H26.9' \
                  or cqm.Code = '193598007' or cqm.Code = '231967008' or cqm.Code = '231968003' or cqm.Code = '34361001' or cqm.Code = '8656007' or cqm.Code = '366.20' or cqm.Code = '366.21' or cqm.Code = '366.22' or cqm.Code = '366.23' or cqm.Code = 'H26.101' or cqm.Code = 'H26.102' or cqm.Code = 'H26.103' or cqm.Code = 'H26.109' or cqm.Code = 'H26.111' or cqm.Code = 'H26.112' or cqm.Code = 'H26.113' or cqm.Code = 'H26.119' or cqm.Code = 'H26.121' or cqm.Code = 'H26.122' or cqm.Code = 'H26.123' or cqm.Code = 'H26.129' or cqm.Code = 'H26.131' or cqm.Code = 'H26.132' or cqm.Code = 'H26.133' or cqm.Code = 'H26.139' \
                  or cqm.Code = '111515007' or cqm.Code = '1412008' or cqm.Code = '204124004' or cqm.Code = '204125003' or cqm.Code = '315353005' or cqm.Code = '34533008' or cqm.Code = '5318001' or cqm.Code = '95723009' or cqm.Code = '743.31' or cqm.Code = 'Q12.0' \
                  or cqm.Code = '193276002' or cqm.Code = '232072004' or cqm.Code = '232133000' or cqm.Code = '232134006' or cqm.Code = '232135007' or cqm.Code = '312898002' or cqm.Code = '32022003' or cqm.Code = '34187009' or cqm.Code = '3712000' or cqm.Code = '408757002' or cqm.Code = '62585004' or cqm.Code = '360.20' or cqm.Code = '360.21' or cqm.Code = 'H44.20' or cqm.Code = 'H44.21' or cqm.Code = 'H44.22' or cqm.Code = 'H44.23' or cqm.Code = 'H44.30' \
                  or cqm.Code = '110262009' or cqm.Code = '12193006' or cqm.Code = '125687005' or cqm.Code = '1869002' or cqm.Code = '210284008' or cqm.Code = '210285009' or cqm.Code = '211483007' or cqm.Code = '21549001' or cqm.Code = '231791008' or cqm.Code = '231795004' or cqm.Code = '231952009' or cqm.Code = '23293006' or cqm.Code = '2532009' or cqm.Code = '315296002' or cqm.Code = '367423000' or cqm.Code = '37911007' or cqm.Code = '416179002' or cqm.Code = '41658006' or cqm.Code = '416786002' or cqm.Code = '417654008' or cqm.Code = '419743001' or cqm.Code = '42312000' or cqm.Code = '42697001' or cqm.Code = '44199000' or cqm.Code = '85100000' or cqm.Code = '95718009' or cqm.Code = '95762000' or cqm.Code = '871.0' or cqm.Code = '871.1' or cqm.Code = '871.2' or cqm.Code = '871.3' or cqm.Code = '871.4' or cqm.Code = '871.5' or cqm.Code = '871.6' or cqm.Code = '871.7' or cqm.Code = '871.9' or cqm.Code = '921.3' or cqm.Code = 'S05.10XA' or cqm.Code = 'S05.11XA' or cqm.Code = 'S05.12XA' or cqm.Code = 'S05.20XA' or cqm.Code = 'S05.21XA' or cqm.Code = 'S05.22XA' or cqm.Code = 'S05.30XA' or cqm.Code = 'S05.31XA' or cqm.Code = 'S05.32XA' or cqm.Code = 'S05.50XA' or cqm.Code = 'S05.51XA' or cqm.Code = 'S05.52XA' or cqm.Code = 'S05.60XA' or cqm.Code = 'S05.61XA' or cqm.Code = 'S05.62XA' or cqm.Code = 'S05.70XA' or cqm.Code = 'S05.71XA' or cqm.Code = 'S05.72XA' or cqm.Code = 'S05.8X1A' or cqm.Code = 'S05.8X2A' or cqm.Code = 'S05.8X9A' or cqm.Code = 'S05.90XA' or cqm.Code = 'S05.91XA' or cqm.Code = 'S05.92XA' \
                  or cqm.Code = '10698009' or cqm.Code = '11226001' or cqm.Code = '12630008' or cqm.Code = '13608004' or cqm.Code = '193487008' or cqm.Code = '193488003' or cqm.Code = '23798003' or cqm.Code = '267619000' or cqm.Code = '29538005' or cqm.Code = '30080002' or cqm.Code = '420485005' or cqm.Code = '46916006' or cqm.Code = '6869001' or cqm.Code = '70461003' or cqm.Code = '77971008' or cqm.Code = '89114005' or cqm.Code = '9091006' or cqm.Code = '364.21' or cqm.Code = '364.22' or cqm.Code = '364.23' or cqm.Code = '364.24' or cqm.Code = '364.3' or cqm.Code = 'H20.20' or cqm.Code = 'H20.21' or cqm.Code = 'H20.22' or cqm.Code = 'H20.23' or cqm.Code = 'H20.811' or cqm.Code = 'H20.812' or cqm.Code = 'H20.813' or cqm.Code = 'H20.819' or cqm.Code = 'H20.821' or cqm.Code = 'H20.822' or cqm.Code = 'H20.823' or cqm.Code = 'H20.829' or cqm.Code = 'H20.9' or cqm.Code = 'H40.40X0' \
                  or cqm.Code = '193501009' or cqm.Code = '51995000' or cqm.Code = '364.42' or cqm.Code = 'H21.1X1' or cqm.Code = 'H21.1X2' or cqm.Code = 'H21.1X3' or cqm.Code = 'H21.1X9' \
                  or cqm.Code = '123670005' or cqm.Code = '1674008' or cqm.Code = '193837009' or cqm.Code = '193839007' or cqm.Code = '231930000' or cqm.Code = '231931001' or cqm.Code = '231933003' or cqm.Code = '231934009' or cqm.Code = '231936006' or cqm.Code = '29504002' or cqm.Code = '32935005' or cqm.Code = '361199007' or cqm.Code = '373426005' or cqm.Code = '39662004' or cqm.Code = '397568004' or cqm.Code = '404633004' or cqm.Code = '416633008' or cqm.Code = '416960004' or cqm.Code = '417065002' or cqm.Code = '417183007' or cqm.Code = '417395001' or cqm.Code = '417651000' or cqm.Code = '418054005' or cqm.Code = '418435001' or cqm.Code = '418946006' or cqm.Code = '419039007' or cqm.Code = '419087002' or cqm.Code = '419197009' or cqm.Code = '419395007' or cqm.Code = '419900000' or cqm.Code = '430888006' or cqm.Code = '45283008' or cqm.Code = '5587004' or cqm.Code = '60258001' or cqm.Code = '75663006' or cqm.Code = '77797009' or cqm.Code = '95488001' or cqm.Code = '371.50' or cqm.Code = '371.51' or cqm.Code = '371.52' or cqm.Code = '371.53' or cqm.Code = '371.54' or cqm.Code = '371.55' or cqm.Code = '371.56' or cqm.Code = '371.57' or cqm.Code = '371.58' or cqm.Code = 'H18.50' or cqm.Code = 'H18.51' or cqm.Code = 'H18.52' or cqm.Code = 'H18.53' or cqm.Code = 'H18.54' or cqm.Code = 'H18.55' or cqm.Code = 'H18.59' \
                  or cqm.Code = '14858001' or cqm.Code = '194029009' or cqm.Code = '52102006' or cqm.Code = '80093006' or cqm.Code = '95773007' or cqm.Code = '376.50' or cqm.Code = '376.51' or cqm.Code = '376.52' or cqm.Code = 'H05.401' or cqm.Code = 'H05.402' or cqm.Code = 'H05.403' or cqm.Code = 'H05.409' or cqm.Code = 'H05.411' or cqm.Code = 'H05.412' or cqm.Code = 'H05.413' or cqm.Code = 'H05.419' or cqm.Code = 'H05.421' or cqm.Code = 'H05.422' or cqm.Code = 'H05.423' or cqm.Code = 'H05.429' \
                  or cqm.Code = '128473001' or cqm.Code = '16553002' or cqm.Code = '186854007' or cqm.Code = '314029000' or cqm.Code = '33382000' or cqm.Code = '398155003' or cqm.Code = '410473001' or cqm.Code = '410476009' or cqm.Code = '410477000' or cqm.Code = '410494003' or cqm.Code = '410501000' or cqm.Code = '410692006' or cqm.Code = '413716003' or cqm.Code = '413851004' or cqm.Code = '414600000' or cqm.Code = '414602008' or cqm.Code = '414689001' or cqm.Code = '414996002' or cqm.Code = '415344002' or cqm.Code = '415359008' or cqm.Code = '416491000' or cqm.Code = '416666007' or cqm.Code = '417321001' or cqm.Code = '418839003' or cqm.Code = '428676003' or cqm.Code = '43363007' or cqm.Code = '444248002' or cqm.Code = '4927003' or cqm.Code = '64015001' or cqm.Code = '95706000' or cqm.Code = '95707009' or cqm.Code = '360.11' or cqm.Code = '360.12' or cqm.Code = 'H44.111' or cqm.Code = 'H44.112' or cqm.Code = 'H44.113' or cqm.Code = 'H44.119' or cqm.Code = 'H44.131' or cqm.Code = 'H44.132' or cqm.Code = 'H44.133' or cqm.Code = 'H44.139' \
                  or cqm.Code = '186266008' or cqm.Code = '193493000' or cqm.Code = '416449002' or cqm.Code = '364.10' or cqm.Code = '364.11' or cqm.Code = 'A18.54' or cqm.Code = 'H20.10' or cqm.Code = 'H20.11' or cqm.Code = 'H20.12' or cqm.Code = 'H20.13' or cqm.Code = 'H20.9' \
                  or cqm.Code = '13282008' or cqm.Code = '16350000' or cqm.Code = '204149000' or cqm.Code = '22135003' or cqm.Code = '268160006' or cqm.Code = '30337003' or cqm.Code = '413921009' or cqm.Code = '419496009' or cqm.Code = '424353002' or cqm.Code = '425961009' or cqm.Code = '54359000' or cqm.Code = '55713007' or cqm.Code = '56530002' or cqm.Code = '64634000' or cqm.Code = '66104007' or cqm.Code = '72494008' or cqm.Code = '95479005' or cqm.Code = '371.00' or cqm.Code = '371.03' or cqm.Code = '371.04' or cqm.Code = 'H17.00' or cqm.Code = 'H17.01' or cqm.Code = 'H17.02' or cqm.Code = 'H17.03' or cqm.Code = 'H17.10' or cqm.Code = 'H17.11' or cqm.Code = 'H17.12' or cqm.Code = 'H17.13' or cqm.Code = 'H17.89' or cqm.Code = 'H17.9' \
                  or cqm.Code = '204149000' or cqm.Code = '22135003' or cqm.Code = '30337003' or cqm.Code = '413921009' or cqm.Code = '424353002' or cqm.Code = '425961009' or cqm.Code = '54359000' or cqm.Code = '55713007' or cqm.Code = '56530002' or cqm.Code = '66104007' or cqm.Code = '72494008' or cqm.Code = '371.01' or cqm.Code = '371.02' or cqm.Code = '371.03' or cqm.Code = '371.04' or cqm.Code = 'H17.00' or cqm.Code = 'H17.01' or cqm.Code = 'H17.02' or cqm.Code = 'H17.03' or cqm.Code = 'H17.10' or cqm.Code = 'H17.11' or cqm.Code = 'H17.12' or cqm.Code = 'H17.13' or cqm.Code = 'H17.811' or cqm.Code = 'H17.812' or cqm.Code = 'H17.813' or cqm.Code = 'H17.819' or cqm.Code = 'H17.821' or cqm.Code = 'H17.822' or cqm.Code = 'H17.823' or cqm.Code = 'H17.829' \
                  or cqm.Code = '204132007' or cqm.Code = '253221000' or cqm.Code = '416671000' or cqm.Code = '419281007' or cqm.Code = '95480008' or cqm.Code = '95481007' or cqm.Code = '95482000' or cqm.Code = '95483005' or cqm.Code = '743.36' or cqm.Code = 'Q12.2' or cqm.Code = 'Q12.4' or cqm.Code = 'Q12.8' \
                  or cqm.Code = '14169000' or cqm.Code = '231977005' or cqm.Code = '231978000' or cqm.Code = '231979008' or cqm.Code = '231980006' or cqm.Code = '37283009' or cqm.Code = '424416009' or cqm.Code = '65814009' or cqm.Code = '379.32' or cqm.Code = '379.33' or cqm.Code = '379.34' or cqm.Code = 'H27.10' or cqm.Code = 'H27.111' or cqm.Code = 'H27.112' or cqm.Code = 'H27.113' or cqm.Code = 'H27.119' or cqm.Code = 'H27.121' or cqm.Code = 'H27.122' or cqm.Code = 'H27.123' or cqm.Code = 'H27.129' or cqm.Code = 'H27.131' or cqm.Code = 'H27.132' or cqm.Code = 'H27.133' or cqm.Code = 'H27.139' \
                  or cqm.Code = '129627002' or cqm.Code = '1794009' or cqm.Code = '231921008' or cqm.Code = '231922001' or cqm.Code = '231923006' or cqm.Code = '248503005' or cqm.Code = '27194006' or cqm.Code = '27536004' or cqm.Code = '49362009' or cqm.Code = '57207003' or cqm.Code = '371.20' or cqm.Code = '371.21' or cqm.Code = '371.22' or cqm.Code = '371.23' or cqm.Code = '371.43' or cqm.Code = '371.44' or cqm.Code = 'H18.10' or cqm.Code = 'H18.11' or cqm.Code = 'H18.12' or cqm.Code = 'H18.13' or cqm.Code = 'H18.20' or cqm.Code = 'H18.221' or cqm.Code = 'H18.222' or cqm.Code = 'H18.223' or cqm.Code = 'H18.229' or cqm.Code = 'H18.231' or cqm.Code = 'H18.232' or cqm.Code = 'H18.233' or cqm.Code = 'H18.239' or cqm.Code = 'H18.421' or cqm.Code = 'H18.422' or cqm.Code = 'H18.423' or cqm.Code = 'H18.429' or cqm.Code = 'H18.43' \
                  or cqm.Code = '408847006' or cqm.Code = '408848001' or cqm.Code = '408849009' or cqm.Code = '408850009' or cqm.Code = '408851008' or cqm.Code = '415297005' or cqm.Code = '362.21' or cqm.Code = 'H35.171' or cqm.Code = 'H35.172' or cqm.Code = 'H35.173' or cqm.Code = 'H35.179' \
                  or \
                  ( \
                    (cqm.StartDate is not null) \
                    and \
                    ( \
                      cqm.Code = '1088455' or cqm.Code = '1100691' or cqm.Code = '197625' or cqm.Code = '197626' or cqm.Code = '197627' or cqm.Code = '197628' or cqm.Code = '198141' or cqm.Code = '199799' or cqm.Code = '260376' or cqm.Code = '312481' or cqm.Code = '312482' or cqm.Code = '312483' or cqm.Code = '312593' or cqm.Code = '312594' or cqm.Code = '313215' or cqm.Code = '313217' or cqm.Code = '313219' or cqm.Code = '636360' or cqm.Code = '636361' or cqm.Code = '861132' or cqm.Code = '861402' or cqm.Code = '863669' or cqm.Code = '996097' \
                    ) \
                  ) \
                  or cqm.Code = '247013009' or cqm.Code = '271608006' or cqm.Code = '301939004' or cqm.Code = '419340001' or cqm.Code = '63251006' or cqm.Code = '379.42' or cqm.Code = 'H57.03' \
                ) \
                and \
                (isNull(cqm.FclId, '') = case when ('"+fclId+"' = '')  then isNull(cqm.FclId, '') else '"+fclId+"' end) and  (isNull(cqm.DctId, '') = case when ('"+dctId+"' = '')  then isNull(cqm.DctId, '') else '"+dctId+"' end) \
              ) \
              select distinct(pop.PatId) \
              from @InitialPopOrDenom pop \
              where \
              ( \
                pop.patId in \
                ( \
                  select pop.PatId from @InitialPopOrDenom pop, @tempTableA tmpa where \
                  ( \
                    (pop.PatId = tmpa.PatId) \
                    and \
                    ( \
                      isNull (tmpa.StopDate, tmpa.DateofVisit) < isNull (pop.StartDate, pop.DateofVisit) \
                    ) \
                  ) \
                ) \
                or \
                pop.patId in \
                ( \
                  select pop.PatId from @InitialPopOrDenom pop, @tempTableB tmpb where \
                  ( \
                    (pop.PatId = tmpb.PatId) \
                    and \
                    ( \
                      (tmpb.StopDate >= isNull (pop.StartDate, pop.DateofVisit) or tmpb.StopDate is null) and (isNull (tmpb.StartDate, tmpb.DateofVisit) < isNull (pop.StartDate, pop.DateofVisit)) \
                    ) \
                  ) \
                ) \
              ) \
        ";


        cqmGuideController.cqmCheck(sql1, function(err, record){
              if(record && record.length > 0)
              {
                  callback({criteriaName: "Denominator Exclusions", isCriteriaQualify : true,  message : null});
              }
              else if(err) {

                  callback({criteriaName: "Denominator Exclusions", isCriteriaQualify : false,  message : err});
              }
              else
              {
                  callback({criteriaName: "Denominator Exclusions", isCriteriaQualify : false,  message : "<p align='justify' class='text-danger'>Procedure, Performed: Prior Pars Plana Vitrectomy before start of catract surgery.</p><p align='justify' class='text-danger'>or Diagnosis Subacute Iridocyclitis, Diagnosis Adhesions and Disruptions of Iris and Ciliary Body etc (Please check doc for more). start before catract surgery and not ends before catract surgery</p>"});
              }
        });

}
